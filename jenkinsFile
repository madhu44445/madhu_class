 node("Thokkalo node"){
	try {
	    mail('Started', "Build has been Triggered.")
                def downloadSpec = """{
 			"files": [
  			{
      				"pattern": "madhu-class/*",
      				"target": "madhu-class/*"
    			}
 		   ]
	}"""
		stage('Fetching Source code from GIT'){
			 deleteDir()
			url: 'https://github.com/madhu44445/madhu_class.git'
		}
		
		stage('Running Test for server spec'){
                     dir('web-activemq'){
			try{
                        
			sh 'ruby -S rspec active_mq_server_spec.rb'
		
                    } catch (err) {
				mail('Failed' , "Build Failed.Error : ${err}")
				}
		 }}
		stage('Success stage '){
			sh 'echo  tested  some server spec stuff'
		}stage('Publishing Reports'){
		    publishHTML([allowMissing: true, 
		    alwaysLinkToLastBuild: false, 
		    keepAll: true, 
		    reportDir: 'target/site/jacoco/', 
		    reportFiles: 'index.html', 
		    reportName: 'Code Coverage', 
		    reportTitles: ''])
		}
		mail('Succes', "Build has been completed successfully.")
	} catch (err) {
		mail('Failed', "Build Failed. Error : ${err}")
	}
}

def mail(status, desc){
    emailext (
        attachLog: true, 
        body: "${desc}", 
        subject: "Build Status : ${status}", 
        to: 'madhu44445@gmail.com'
    )
}
